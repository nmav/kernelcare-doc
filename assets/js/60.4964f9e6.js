(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{385:function(e,a,t){"use strict";t.r(a);var s=t(32),r=Object(s.a)({},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"eportal"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportal","aria-hidden":"true"}},[e._v("#")]),e._v(" ePortal")]),e._v(" "),t("p",[e._v("KernelCare Enterprise includes a web management console (ePortal)\nfor protected environments.")]),e._v(" "),t("p",[e._v("ePortal software can help protect servers located behind the\nfirewall (i.e. with no internet access) and can be installed both\non-premises and in the cloud.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-overview.svg",alt:"Overview"}})]),e._v(" "),t("h2",{attrs:{id:"eportal-hardware-requirements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportal-hardware-requirements","aria-hidden":"true"}},[e._v("#")]),e._v(" ePortal Hardware Requirements")]),e._v(" "),t("p",[t("strong",[e._v("Disk")])]),e._v(" "),t("ul",[t("li",[e._v("100 GB minimum, 200 GB recommended (20GB in case of cache mode)")]),e._v(" "),t("li",[e._v("SSD with at least 100 IOPS")])]),e._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[e._v("Note")]),t("p",[e._v("SSD based storage is a crucial requirement for ePortal server.")])]),t("p",[t("strong",[e._v("CPU")])]),e._v(" "),t("p",[e._v("As far as other requirements concerned, we have tested the following configuration\nand the following number of connected servers:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("10k of connected machines is the maximum for the following requirements:")]),e._v(" "),t("ul",[t("li",[e._v("VM")]),e._v(" "),t("li",[e._v("1 VCPU")]),e._v(" "),t("li",[e._v("1 GB RAM")])])]),e._v(" "),t("li",[t("p",[e._v("75k of connected machines is the maximum for the following requirements:")]),e._v(" "),t("ul",[t("li",[e._v("Core i5")]),e._v(" "),t("li",[e._v("1 CPU")]),e._v(" "),t("li",[e._v("4 GB RAM")])])])]),e._v(" "),t("h2",{attrs:{id:"installation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#installation","aria-hidden":"true"}},[e._v("#")]),e._v(" Installation")]),e._v(" "),t("p",[e._v("ePortal is compatible with 64-bit versions of EL7/8 based distros like CentOS 7/8, AlmaLinux 8 and\nUbuntu 20.04.")]),e._v(" "),t("h3",{attrs:{id:"rhel-based-distros"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rhel-based-distros","aria-hidden":"true"}},[e._v("#")]),e._v(" RHEL-based distros")]),e._v(" "),t("p",[e._v("For installation and workability of ePortal the Nginx web server is required.\nWe recommend to use stable version from the official Nginx repository:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cat > /etc/yum.repos.d/nginx.repo <<EOL\n[nginx]\nname=nginx stable repo\nbaseurl=http://nginx.org/packages/centos/\\$releasever/\\$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\nEOL\n")])])]),t("p",[e._v("You can find more information at "),t("a",{attrs:{href:"https://nginx.org/en/linux_packages.html#stable",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://nginx.org/en/linux_packages.html#stable"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("Setup ePortal repo:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cat > /etc/yum.repos.d/kcare-eportal.repo <<EOL\n[kcare-eportal]\nname=KernelCare ePortal\nbaseurl=https://www.repo.cloudlinux.com/kcare-eportal/\\$releasever/\\$basearch/\nenabled=1\ngpgkey=https://repo.cloudlinux.com/kernelcare/RPM-GPG-KEY-KernelCare\ngpgcheck=1\nEOL\n")])])]),t("p",[e._v("Install ePortal:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("yum install -y kcare-eportal\n")])])]),t("h3",{attrs:{id:"ubuntu-20-04"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-20-04","aria-hidden":"true"}},[e._v("#")]),e._v(" Ubuntu 20.04")]),e._v(" "),t("p",[e._v("Setup ePortal repo:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("apt-get install -y --no-install-recommends curl ca-certificates\n\ncurl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg\n\ncat > /etc/apt/sources.list.d/kcare-eportal.list <<EOL\ndeb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/20.04 focal main\nEOL\n")])])]),t("p",[e._v("Install ePortal:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("apt-get update && apt-get install -y --no-install-recommends kcare-eportal\n")])])]),t("h2",{attrs:{id:"cache-mode"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cache-mode","aria-hidden":"true"}},[e._v("#")]),e._v(" Cache mode")]),e._v(" "),t("p",[e._v("Cache mode allows to greatly reduce disk usage requirements and speed up\ninitial downloading step.")]),e._v(" "),t("p",[e._v("In cache mode ePortal downloads only lightweight meta information about\npatchsets and proxies patch requests from KernelCare agent to the patch server\n(Patch Source). Downloaded patch binaries are cached for 2 weeks and\naccessible for following requests directly from ePortal and doesn't consume\npublic internet bandwidth.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-cache-mode.svg",alt:"Cache mode"}})]),e._v(" "),t("h3",{attrs:{id:"enable-cache-mode"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#enable-cache-mode","aria-hidden":"true"}},[e._v("#")]),e._v(" Enable cache mode")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("add")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("CACHE_MODE = True\n")])])]),t("p",[e._v("setting into "),t("a",{attrs:{href:"#config-files"}},[e._v("ePortal config file")])])]),e._v(" "),t("li",[t("p",[e._v("restart ePortal")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl restart eportal\n")])])])])]),e._v(" "),t("p",[e._v("For existing installation you have to refetch meta info for existing patchsets:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kcare/kc.eportal cache-mode --fetch-meta\n")])])]),t("h3",{attrs:{id:"disable-cache-mode"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#disable-cache-mode","aria-hidden":"true"}},[e._v("#")]),e._v(" Disable cache mode")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("remove or comment line with")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("CACHE_MODE = True\n")])])]),t("p",[e._v("in "),t("a",{attrs:{href:"#config-files"}},[e._v("ePortal config file")])])]),e._v(" "),t("li",[t("p",[e._v("download missing patchests")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kcare/kc.eportal kcare download-missing\n")])])])]),e._v(" "),t("li",[t("p",[e._v("restart ePortal")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl restart eportal\n")])])])])]),e._v(" "),t("h2",{attrs:{id:"proxy-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#proxy-configuration","aria-hidden":"true"}},[e._v("#")]),e._v(" Proxy configuration")]),e._v(" "),t("p",[e._v("ePortal can fetch packages and patches via customer's proxy server.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-with-proxy.svg",alt:"Proxy"}})]),e._v(" "),t("p",[e._v("On the ePortal machine, you should define the same proxy settings as you use\nin the command line.")]),e._v(" "),t("p",[e._v("To do so, add "),t("code",[e._v("PROXY = 'http://example.com:3128'")]),e._v("\ninto "),t("a",{attrs:{href:"#config-files"}},[e._v("ePortal config file")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("echo -e \"\\nPROXY = 'http://example.com:3128'\" >> /etc/eportal/config\n")])])]),t("p",[e._v("ePortal supports SOCKS5 proxy via "),t("code",[e._v("socks5://")]),e._v(" proxy scheme:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("PROXY = 'socks5://example.com:1080'\n")])])]),t("p",[e._v("Restart ePortal (see "),t("a",{attrs:{href:"#stopping-starting"}},[e._v("Stopping & Starting")]),e._v("\nsection, choose a corresponding OS).")]),e._v(" "),t("h2",{attrs:{id:"auth-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#auth-configuration","aria-hidden":"true"}},[e._v("#")]),e._v(" Auth configuration")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th"),e._v(" "),t("th")])]),e._v(" "),t("tbody",[t("tr",[t("td",[t("code",[e._v("AUTH_PASSWORD_MIN_LENGTH")])]),e._v(" "),t("td",[e._v("Minimal password length, default 5")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("AUTH_SESSION_LIFETIME")])]),e._v(" "),t("td",[e._v("Session lifetime in seconds, by default session will last till browser closing")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("AUTH_REFRESH_SESSION")])]),e._v(" "),t("td",[e._v("If "),t("code",[e._v("False")]),e._v(" (default), expires session after lifetime seconds after login. If "),t("code",[e._v("True")]),e._v(", expires session after lifetime seconds of inactivity.")])])])]),e._v(" "),t("p",[e._v("You can set configuration in "),t("a",{attrs:{href:"#config-files"}},[e._v("ePortal config file")]),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"managing-users"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#managing-users","aria-hidden":"true"}},[e._v("#")]),e._v(" Managing Users")]),e._v(" "),t("p",[e._v("You can manage portal using "),t("code",[e._v("kc.eportal user")]),e._v(" utility:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("usage: kc.eportal user [-h] [-a] [-c] [-d] [-p PASSWORD] [-r {admin,readonly}] [--note NOTE] [user]\n\nlist available users by default\n\npositional arguments:\n  user                  user name\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -a                    action: add new user\n  -c                    action: change user\n  -d                    action: delete user\n  -p PASSWORD, --password PASSWORD\n  -r {admin,readonly}, --role {admin,readonly}\n  --note NOTE           description\n")])])]),t("p",[e._v("To add a user:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal user -a -p AdminPassword admin\n")])])]),t("p",[e._v("To change user's password:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal user -c -p NewPassword admin\n")])])]),t("p",[e._v("Set user as read-only:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal user -c -r readonly admin\n")])])]),t("h2",{attrs:{id:"authentication-using-ldap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#authentication-using-ldap","aria-hidden":"true"}},[e._v("#")]),e._v(" Authentication using LDAP")]),e._v(" "),t("p",[e._v("ePortal supports LDAP authentication via bind operation. Every user should\nhave a DN with an ability to perform bind request. ePortal doesn't sync\nusers so you don't need to set special DN/password to access LDAP server.")]),e._v(" "),t("h3",{attrs:{id:"configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[e._v("#")]),e._v(" Configuration")]),e._v(" "),t("p",[e._v("LDAP configuration settings are available inside "),t("code",[e._v("Settings / LDAP")]),e._v(" navigation item.")]),e._v(" "),t("h4",{attrs:{id:"url"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url","aria-hidden":"true"}},[e._v("#")]),e._v(" URL")]),e._v(" "),t("p",[e._v("Specifies host, port, and protocol of LDAP server to connect to.")]),e._v(" "),t("p",[e._v("Format: "),t("code",[e._v("<scheme>://<host>[:port][?params]")]),e._v(".")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("scheme")]),e._v(":\n"),t("ul",[t("li",[t("code",[e._v("ldap")]),e._v(": a verified encrypted TLS connection, you can specify "),t("code",[e._v("tls=0")]),e._v(" to use\ninsecure connection;")]),e._v(" "),t("li",[t("code",[e._v("ldaps")]),e._v(": an SSL connection;")])])]),e._v(" "),t("li",[t("strong",[e._v("host")]),e._v(": hostname or ip of your LDAP server;")]),e._v(" "),t("li",[t("strong",[e._v("port")]),e._v(": custom port, by default 389 for "),t("code",[e._v("ldap")]),e._v(" and 636 for "),t("code",[e._v("ldaps")]),e._v(" scheme;")]),e._v(" "),t("li",[t("strong",[e._v("params")]),e._v(":\n"),t("ul",[t("li",[t("code",[e._v("strict_check=0")]),e._v(": enable/disable strict SSL certificate verification (enabled by default);")]),e._v(" "),t("li",[t("code",[e._v("tls=0")]),e._v(": enable/disable TLS handshake on connect (enabled by default);")]),e._v(" "),t("li",[t("code",[e._v("timeout=30")]),e._v(": LDAP server connection timeout (in seconds, 5 by default).")])])])]),e._v(" "),t("p",[e._v("For example:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("ldap://ldap.forumsys.com?tls=0&timeout=30")]),e._v(": use insecure connection with 30s\nconnection timeout.")])]),e._v(" "),t("h4",{attrs:{id:"connection-string-dn-template"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#connection-string-dn-template","aria-hidden":"true"}},[e._v("#")]),e._v(" Connection String (DN template)")]),e._v(" "),t("p",[e._v("Connection string is a DN template used in LDAP bind operation. All "),t("code",[e._v("%s")]),e._v("\ntemplate placeholders will be replaced with username from login form.")]),e._v(" "),t("p",[e._v("For example: "),t("code",[e._v("uid=%s,dc=example,dc=com")]),e._v(".")]),e._v(" "),t("p",[e._v("Some LDAP implementations support additional templates for bind requests:")]),e._v(" "),t("ul",[t("li",[e._v("Active Directory accepts "),t("code",[e._v("%s@example.com")]),e._v(" template;")]),e._v(" "),t("li",[t("code",[e._v("cn=%s,dc=example,dc=com")]),e._v(" or "),t("code",[e._v("email=%s,dc=example,dc=com")]),e._v(" can be also valid.")])]),e._v(" "),t("h4",{attrs:{id:"filter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filter","aria-hidden":"true"}},[e._v("#")]),e._v(" Filter")]),e._v(" "),t("p",[e._v("Filter is an optional setting which specifies parameters for an additional LDAP\nsearch request to limit users who have access to ePortal. Usually it is a check\nof a group user belongs to. If search returns non-empty result user will be\nconsidered authenticated.")]),e._v(" "),t("p",[e._v("Format: "),t("code",[e._v("<base>??<scope>?<filter>")]),e._v(", is a part of\n"),t("a",{attrs:{href:"https://tools.ietf.org/html/rfc2255",target:"_blank",rel:"noopener noreferrer"}},[e._v("The LDAP URL Format RFC"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("base")]),e._v(": a search base, a root node to perform search from;")]),e._v(" "),t("li",[t("strong",[e._v("scope")]),e._v(": a search scope;\n"),t("ul",[t("li",[t("code",[e._v("base")]),e._v(": search only for base (default);")]),e._v(" "),t("li",[t("code",[e._v("one")]),e._v(": search for direct ascendants only (one level deep from base);")]),e._v(" "),t("li",[t("code",[e._v("sub")]),e._v(": search in whole tree;")])])]),e._v(" "),t("li",[t("strong",[e._v("filter")]),e._v(": search filter to apply.")])]),e._v(" "),t("p",[e._v("For example: "),t("code",[e._v("dc=example,dc=com??one?(&(ou=mathematicians)(uniqueMember=uid=%s,dc=example,dc=com))")])]),e._v(" "),t("p",[e._v("Take note. You can use "),t("code",[e._v("%s")]),e._v(" placeholder in "),t("code",[e._v("Filter")]),e._v(" setting as well. It will be\nreplaced with username from login form.")]),e._v(" "),t("h3",{attrs:{id:"login-process"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#login-process","aria-hidden":"true"}},[e._v("#")]),e._v(" Login process")]),e._v(" "),t("p",[e._v("When a user logs in to ePortal, ePortal checks the user credentials in the local\ndatabase at first. If the credentials are found, the user will be authenticated,\nand only if the user credentials are not found, ePortal redirects to LDAP.")]),e._v(" "),t("p",[e._v("When you log in to ePortal with your LDAP credentials for the first time,\na user with LDAP username, read-only permissions, and "),t("code",[e._v("LDAP")]),e._v(" description\nis created in the database by default ("),t("code",[e._v("https://<eportal>/admin/user/")]),e._v(").")]),e._v(" "),t("p",[e._v("In the picture, you can see one user created with "),t("code",[e._v("kc.eportal")]),e._v(" command line\ninterface and two users logged in with LDAP credentials.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportalLDAPusers.png",alt:""}})]),e._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[e._v("Note")]),t("p",[e._v("Take note. All fresh LDAP users have read-only permissions. You can set\nadmin rights on "),t("code",[e._v("User edit")]),e._v(" page by turning off "),t("code",[e._v("Readonly")]),e._v(" field.")])]),t("h3",{attrs:{id:"basic-setup-example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#basic-setup-example","aria-hidden":"true"}},[e._v("#")]),e._v(" Basic setup example")]),e._v(" "),t("p",[e._v("This and following example are based on public test LDAP server\n"),t("a",{attrs:{href:"https://www.forumsys.com/tutorials/integration-how-to/ldap/online-ldap-test-server/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ldap.forumsys.com"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("Here is a list of our users:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(objectClass=person)' dn\ndn: uid=tesla,dc=example,dc=com\ndn: uid=gauss,dc=example,dc=com\n...\n")])])]),t("p",[e._v("Basic setup only checks if provided username/password can bind to your directory\nservice. Take note: all fresh users have read-only permission. So you can\nsafely allow to login into eportal for all LDAP users and set correct\npermissions individually.")]),e._v(" "),t("p",[e._v("For basic setup you should fill "),t("code",[e._v("Url")]),e._v(" and  "),t("code",[e._v("Connection string")]),e._v(" settings:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Setting")]),e._v(" "),t("th",[e._v("Value")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("URL")]),e._v(" "),t("td",[e._v("ldap://ldap.forumsys.com?tls=0")])]),e._v(" "),t("tr",[t("td",[e._v("Connection string")]),e._v(" "),t("td",[e._v("uid=%s,dc=example,dc=com")])])])]),e._v(" "),t("p",[e._v("After that you can login using "),t("code",[e._v("gauss:password")]),e._v(" or "),t("code",[e._v("tesla:password")]),e._v(" credentials.")]),e._v(" "),t("h3",{attrs:{id:"filter-setup-example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filter-setup-example","aria-hidden":"true"}},[e._v("#")]),e._v(" Filter setup example")]),e._v(" "),t("p",[e._v("Filter allows to limit a set of users permitted to login into ePortal, for\nexample users belonging to "),t("code",[e._v("mathematicians")]),e._v(" group.")]),e._v(" "),t("p",[e._v("Here are our example groups:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(objectClass=groupOfUniqueNames)' dn\ndn: ou=mathematicians,dc=example,dc=com\ndn: ou=scientists,dc=example,dc=com\n...\n")])])]),t("p",[e._v("And "),t("code",[e._v("mathematicians")]),e._v(" group attributes:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(ou=mathematicians)'\ndn: ou=mathematicians,dc=example,dc=com\nuniqueMember: uid=euclid,dc=example,dc=com\nuniqueMember: uid=riemann,dc=example,dc=com\nuniqueMember: uid=euler,dc=example,dc=com\nuniqueMember: uid=gauss,dc=example,dc=com\nuniqueMember: uid=test,dc=example,dc=com\nou: mathematicians\ncn: Mathematicians\nobjectClass: groupOfUniqueNames\nobjectClass: top\n")])])]),t("p",[e._v("ePortal LDAP settings to limit allowed users:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Setting")]),e._v(" "),t("th",[e._v("Value")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("URL")]),e._v(" "),t("td",[e._v("ldap://ldap.forumsys.com?tls=0")])]),e._v(" "),t("tr",[t("td",[e._v("Filter")]),e._v(" "),t("td",[e._v("dc=example,dc=com??one?(&(ou=mathematicians)(uniqueMember=uid=%s,dc=example,dc=com))")])]),e._v(" "),t("tr",[t("td",[e._v("Connection string")]),e._v(" "),t("td",[e._v("uid=%s,dc=example,dc=com")])])])]),e._v(" "),t("p",[e._v("Filter idea is to find the "),t("code",[e._v("mathematicians")]),e._v(" group which has an attribute\n"),t("code",[e._v("uniqueMember")]),e._v(" equal to DN of our user who tries to login.")]),e._v(" "),t("p",[e._v("After that you can login using "),t("code",[e._v("gauss:password")]),e._v(" but not "),t("code",[e._v("tesla:password")]),e._v(" credentials.")]),e._v(" "),t("h2",{attrs:{id:"accessing-eportal"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#accessing-eportal","aria-hidden":"true"}},[e._v("#")]),e._v(" Accessing ePortal")]),e._v(" "),t("p",[e._v("To access KernelCare.eportal management console, connect to:\n"),t("strong",[e._v("http://YOUR_IP/admin")])]),e._v(" "),t("p",[e._v("And enter your login & password")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/access_eportal.png",alt:""}})]),e._v(" "),t("p",[e._v("You can manage your login information using "),t("a",{attrs:{href:"#managing-users"}},[e._v("kc.eportal tool")]),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"patchset-deployment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#patchset-deployment","aria-hidden":"true"}},[e._v("#")]),e._v(" PatchSet deployment")]),e._v(" "),t("p",[e._v("ePortal has built-in mechanism to download latest patches. To start\nusing it, click "),t("em",[e._v("Settings")]),e._v(" link in ePortal navigational bar and\nthen click "),t("em",[e._v("Patch Source")]),e._v(". To get access, please contact\n"),t("a",{attrs:{href:"mailto:sales@tuxcare.com"}},[e._v("sales@tuxcare.com")]),e._v(" and request your ePortal\naccess credentials.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-edit-patch-source.png",alt:""}})]),e._v(" "),t("p",[e._v("You can choose only a limited set of distros to fetch to reduce disk\nspace and network bandwidth requirements.")]),e._v(" "),t("p",[e._v("Once you set up patch source access info, you will get to a list of available patchsets.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-dashboard.png",alt:""}})]),e._v(" "),t("ul",[t("li",[t("p",[t("strong",[e._v("Usage")]),e._v(": amount of servers using particular patchset on any\nfeed. You can click on the number to see a list of servers using the patchset.")])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("Patchsets")]),e._v(": name of the patchset. Click on a name will show patchset\nchangelog.")])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("Feed name")]),e._v(": cells show patchset deployment and server usage status on particular feed.\nNumbers are also clickable to filter server list.")])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("Manage")]),e._v(": opens dialog to enable/disable the patchset.")])])]),e._v(" "),t("h3",{attrs:{id:"manage-patchset-page"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manage-patchset-page","aria-hidden":"true"}},[e._v("#")]),e._v(" Manage patchset page")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-manage.png",alt:""}})]),e._v(" "),t("p",[e._v("In this dialog you can control which patchsets will be enabled/disabled on\ncorresponding feeds.")]),e._v(" "),t("ul",[t("li",[t("p",[t("strong",[e._v("Enable all up to this patchset")]),e._v(": action will enable all patchsets\n(excluding "),t("strong",[e._v("disabled")]),e._v(") up to this patchset.")])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("Enable")]),e._v(": action will enable only current patchset.")])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("Disable")]),e._v(": action will disable only current patchset. Disabled patchsets\nare immune to auto-update and mass-enabling via "),t("strong",[e._v("Enable all up to this patchset")]),e._v("\naction.")])])]),e._v(" "),t("p",[e._v("To unroll patchset from CLI, run:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal --unroll 16012017_1\n")])])]),t("h3",{attrs:{id:"script-to-automatically-install-latest-patchsets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#script-to-automatically-install-latest-patchsets","aria-hidden":"true"}},[e._v("#")]),e._v(" Script to automatically install latest patchsets")]),e._v(" "),t("p",[e._v("It determines if latest patches are available and installs them to the "),t("strong",[e._v("default feed")]),e._v(".")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal --get-latest\n")])])]),t("p",[e._v("If you need to update other feeds that are marked for auto update instead of\nthe default one, use a different argument:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal --auto-update\n")])])]),t("p",[e._v("Note, that the latter command will update only feeds that has "),t("code",[e._v("Autoupdate")]),e._v("\nattribute.")]),e._v(" "),t("h3",{attrs:{id:"script-to-deploy-release-from-a-file"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#script-to-deploy-release-from-a-file","aria-hidden":"true"}},[e._v("#")]),e._v(" Script to deploy release from a file")]),e._v(" "),t("p",[e._v("If you have no opportunity to connect your ePortal server to the KernelCare\npatch server to download patchsets directly from it, you can do it manually.")]),e._v(" "),t("p",[e._v("If you have a location with already downloaded patchsets, and would like to\nidentify the latest patchset file to be moved, you can compare the lists of\narchives you have with the content of the "),t("code",[e._v("/usr/share/kcare-eportal/arch/")]),e._v("\nfolder.")]),e._v(" "),t("p",[e._v("After that, upload the selected patchsets to your ePortal server and run the\n"),t("code",[e._v("kc.eportal --deploy")]),e._v(" command for each of them.")]),e._v(" "),t("h4",{attrs:{id:"example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example","aria-hidden":"true"}},[e._v("#")]),e._v(" Example")]),e._v(" "),t("p",[e._v("Lets find out the difference between a test and a production ePortal instances:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("comm")]),e._v(" -23 \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("ssh eportal-test "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ls /usr/share/kcare-eportal/arch/K*.tar.bz2"')]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sort")]),e._v(" -h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("ssh eportal-prod "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ls /usr/share/kcare-eportal/arch/K*.tar.bz2"')]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sort")]),e._v(" -h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("tee")]),e._v(" patchsets.diff\n")])])]),t("p",[e._v("Upload patchsets to the production:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" patchsets.diff "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("xargs")]),e._v(" -Phav "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("rsync")]),e._v(" -iv eportal-test:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" /tmp/\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("rsync")]),e._v(" -Phav /tmp/K*.tar.bz2 eportal-prod:/tmp/\n")])])]),t("p",[e._v("Run the deployment tool with patchset file name as a parameter:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" eportal-prod "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'ls /tmp/K*.tar.bz2 | sort -h | xargs -n1 kc.eportal kcare deploy'")]),e._v("\n2021-12-02 01:25:06,555 - eportal.patches - INFO - K04082020_1 was enabled "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" main\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n")])])]),t("div",{staticClass:"danger custom-block"},[t("p",{staticClass:"custom-block-title"},[e._v("Note")]),t("p",[e._v("Please note that procedure above should be done for all other types of\npatchsets (like libcare and qemu) "),t("em",[e._v("separately")]),e._v(". Use corresponding file prefixes\nand commands like "),t("code",[e._v("kc.eportal libcare deploy")]),e._v(".")])]),t("h3",{attrs:{id:"clean-obsolete-releases"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#clean-obsolete-releases","aria-hidden":"true"}},[e._v("#")]),e._v(" Clean obsolete releases")]),e._v(" "),t("p",[e._v("The list of provided patches is reduced once in a month (old patches that have\nnewer versions are removed), but resources are not deleted from ePortal machine.\nThe control of resource deletion is in charge of the ePortal administrator. To\nfree disk space on ePortal old release resources could be removed.")]),e._v(" "),t("p",[e._v("To check what releases will be removed:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("DRY_RUN=1 kc.eportal --clean-releases\n")])])]),t("p",[e._v("To remove obsolete releases:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal --clean-releases\n")])])]),t("h2",{attrs:{id:"libcare-patchset-deployment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#libcare-patchset-deployment","aria-hidden":"true"}},[e._v("#")]),e._v(" LibCare PatchSet Deployment")]),e._v(" "),t("p",[e._v("Starting from version 1.18, ePortal supports the LibCare patchset management. It\nis accessible from the "),t("code",[e._v("Patches / LibCare")]),e._v(" navigation item. LibCare patches\nuse the same Patch Source credentials, and you don't need to perform additional\nconfiguration.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-libcare-feed.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"cli-to-install-the-latest-patchsets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-to-install-the-latest-patchsets","aria-hidden":"true"}},[e._v("#")]),e._v(" CLI to install the latest patchsets")]),e._v(" "),t("p",[e._v("To update the default feed, run the following command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal libcare update\n")])])]),t("p",[e._v("To update the "),t("code",[e._v("test")]),e._v(" feed, run the following command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal libcare update --feed test\n")])])]),t("p",[e._v("To update all auto-feeds, run the following command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal libcare auto-update\n")])])]),t("h3",{attrs:{id:"cli-to-deploy-patchset-from-archive"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-to-deploy-patchset-from-archive","aria-hidden":"true"}},[e._v("#")]),e._v(" CLI to deploy patchset from archive")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("~$ kc.eportal libcare deploy --help\nusage: kc.eportal libcare deploy [-h] [--feed FEED] [--disabled] archive\n\npositional arguments:\n  archive      path to archive\n\noptional arguments:\n  -h, --help   show this help message and exit\n  --feed FEED  feed to deploy archive to\n  --disabled   do not enable patchset after deploy\n")])])]),t("p",[e._v("For example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal libcare deploy --feed test /tmp/U20210129_02.tar.bz2\n")])])]),t("p",[e._v("This command will deploy and enable the "),t("code",[e._v("U20210129_02")]),e._v(" patchset in to the "),t("code",[e._v("test")]),e._v(" feed.")]),e._v(" "),t("h2",{attrs:{id:"qemu-patchset-deployment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#qemu-patchset-deployment","aria-hidden":"true"}},[e._v("#")]),e._v(" QEMU PatchSet Deployment")]),e._v(" "),t("p",[e._v("Starting from version 1.25, ePortal supports the QEMU patchset management. It\nis accessible from the "),t("code",[e._v("Patches / QEMUcare")]),e._v(" navigation item. QEMU patches\nuse the same Patch Source credentials, and you don't need to perform additional\nconfiguration.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-qemu-feed.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"cli-to-install-the-latest-patchsets-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-to-install-the-latest-patchsets-2","aria-hidden":"true"}},[e._v("#")]),e._v(" CLI to install the latest patchsets")]),e._v(" "),t("p",[e._v("To update the default feed, run the following command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal qemu update\n")])])]),t("p",[e._v("To update the "),t("code",[e._v("test")]),e._v(" feed, run the following command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal qemu update --feed test\n")])])]),t("p",[e._v("To update all auto-feeds, run the following command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal qemu auto-update\n")])])]),t("h3",{attrs:{id:"cli-to-deploy-patchset-from-archive-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-to-deploy-patchset-from-archive-2","aria-hidden":"true"}},[e._v("#")]),e._v(" CLI to deploy patchset from archive")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("~$ kc.eportal qemu deploy --help\nusage: kc.eportal qemu deploy [-h] [--feed FEED] [--disabled] archive\n\npositional arguments:\n  archive      path to archive\n\noptional arguments:\n  -h, --help   show this help message and exit\n  --feed FEED  feed to deploy archive to\n  --disabled   do not enable patchset after deploy\n")])])]),t("p",[e._v("For example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal qemu deploy --feed test /tmp/U20210818_01-qemu.tar.bz2\n")])])]),t("p",[e._v("This command will deploy and enable the "),t("code",[e._v("U20210818_01-qemu")]),e._v(" patchset in to the "),t("code",[e._v("test")]),e._v(" feed.")]),e._v(" "),t("h2",{attrs:{id:"managing-keys"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#managing-keys","aria-hidden":"true"}},[e._v("#")]),e._v(" Managing Keys")]),e._v(" "),t("p",[e._v("To register new servers you need to create a KernelCare key that will be used\nfor server registration. To go to the list of keys, click the "),t("em",[e._v("Keys")]),e._v(" navigation\nitem.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/key-menu_zoom70.png",alt:""}})]),e._v(" "),t("ul",[t("li",[e._v("To edit a key, click "),t("img",{attrs:{src:"/images/eportal_keys_edit.png",alt:""}}),e._v(". The "),t("em",[e._v("Edit")]),e._v(" tab opens.")]),e._v(" "),t("li",[e._v("To remove a key, click "),t("img",{attrs:{src:"/images/eportal_keys_remove.png",alt:""}}),e._v(". Please note, that\nremoving the key would remove all servers under that key.")]),e._v(" "),t("li",[e._v("Click a key to go to Servers tab with the list of\n"),t("a",{attrs:{href:"#managing-servers"}},[e._v("servers registered")]),e._v(" under that key.\nYou can also remove servers on that tab.")])]),e._v(" "),t("p",[e._v("To create a new registration click "),t("em",[e._v("Create")]),e._v(" tab.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/key-creation_zoom70.png",alt:""}})]),e._v(" "),t("p",[e._v("Fill in the following fields:")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Key")]),e._v(" —  you can provide a key value or leave the field empty, so an\nautomatically generated key will be used")]),e._v(" "),t("li",[t("strong",[e._v("Description")]),e._v(" — you can provide a description for the key")]),e._v(" "),t("li",[t("strong",[e._v("Server Limit")]),e._v(" — the amount of servers that can be registered under that key")]),e._v(" "),t("li",[t("strong",[e._v("Feed")]),e._v(" — select a specific feed or leave empty.")])]),e._v(" "),t("p",[e._v("Click "),t("em",[e._v("Save")]),e._v(" to add the key. The new registration key will be created and added\nto the list. The key itself will be used as a part of the registration command\non an individual server.")]),e._v(" "),t("p",[e._v("Click "),t("em",[e._v("Save and Add Another")]),e._v(" to save this key and add one more key.")]),e._v(" "),t("p",[e._v("Click "),t("em",[e._v("Save and Continue Editing")]),e._v(" to add the key and open the key edit tab.")]),e._v(" "),t("p",[e._v("Click "),t("em",[e._v("Cancel")]),e._v(" to return to the key list tab without adding a new key.")]),e._v(" "),t("h3",{attrs:{id:"cli-to-manage-keys"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-to-manage-keys","aria-hidden":"true"}},[e._v("#")]),e._v(" CLI to manage keys")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("~$ kc.eportal key --help\nusage: kc.eportal key [-h] [-a] [-c] [--note NOTE]\n                      [--server-limit SERVER_LIMIT] [--feed FEED]\n                      [key]\n\nlist available keys by default\n\npositional arguments:\n  key                   key name\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -a                    action: add new key\n  -c                    action: change key\n  --note NOTE           key description\n  --server-limit SERVER_LIMIT\n                        maximum number of servers allowed\n  --feed FEED           feed to associate key to\n")])])]),t("p",[e._v("List keys:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal key\n")])])]),t("p",[e._v("Autogenerate key:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal key -a\n")])])]),t("p",[e._v("Create key with specified value:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal key -a test\n")])])]),t("p",[e._v("Set feed to key:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal key -c test --feed test\n")])])]),t("h2",{attrs:{id:"managing-servers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#managing-servers","aria-hidden":"true"}},[e._v("#")]),e._v(" Managing Servers")]),e._v(" "),t("p",[e._v("You can see servers belonging to the key by clicking on the key itself in\n"),t("a",{attrs:{href:"#managing-keys"}},[e._v("Managing Keys")]),e._v(" interface.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/server_list_1_zoom70.png",alt:""}})]),e._v(" "),t("p",[e._v("The screen shows servers registered under the key, their IP, hostname,\neffective kernel as well as the time of registration and last check in.")]),e._v(" "),t("p",[e._v("To view the list of all servers IDs that are connected to the particular key,\ndo the following:")]),e._v(" "),t("ul",[t("li",[e._v("In the UI go to the page with the list of keys. Then click the particular\nkey. The list of servers connected to this key will be displayed.")])]),e._v(" "),t("p",[e._v("To view the list of all servers IDs that are not connected to any key, use the\n"),t("span",{staticClass:"notranslate"},[t("em",[e._v("Servers")])]),e._v(" button on the navigation bar.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-servers.png",alt:""}})]),e._v(" "),t("p",[e._v("Also you can use CLI to see pairs of key/number of servers run:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ kc.eportal --list-servers\nCount | Key\n----- + --------------------------------\n    0 | 2shcolu7Y1x6885Q\n    2 | 6J89aS44j6OmTr05\n")])])]),t("h3",{attrs:{id:"clean-inactive-servers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#clean-inactive-servers","aria-hidden":"true"}},[e._v("#")]),e._v(" Clean inactive servers")]),e._v(" "),t("p",[e._v("Servers inactive for more than 30 days can be removed using the followed command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ kc.eportal server clean --inactive\n2 servers were deleted\n")])])]),t("p",[e._v("Clean-up of inactive servers can be performed automatically every day or rarer.\nTo enable daily auto clean-up, you can add an option "),t("code",[e._v("CLEAN_INACTIVE_SERVERS_PERIOD = 3600 * 24")]),e._v(" (value in seconds)\nin the "),t("a",{attrs:{href:"#config-files"}},[e._v("ePortal config file")]),e._v(".")]),e._v(" "),t("h3",{attrs:{id:"show-extended-check-in-statistics-in-admin-ui"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#show-extended-check-in-statistics-in-admin-ui","aria-hidden":"true"}},[e._v("#")]),e._v(" Show extended check-in statistics in admin UI")]),e._v(" "),t("p",[e._v("A new table is added to the starting page. This table displays the following:")]),e._v(" "),t("ul",[t("li",[e._v("Total number of servers.")]),e._v(" "),t("li",[e._v("Number of servers that checked in for the past 48 hours.")])]),e._v(" "),t("p",[e._v("The number of servers for each key is listed on the "),t("em",[e._v("Keys")]),e._v(" page.")]),e._v(" "),t("h2",{attrs:{id:"feed-management"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#feed-management","aria-hidden":"true"}},[e._v("#")]),e._v(" Feed Management")]),e._v(" "),t("p",[e._v("Feeds are intended to manage patchsets on the server, and they provide\na possibility to bind a set of patches to a specific key. Possible use cases:\nfor preliminary testing of patches, for applying updates to groups of\nservers with the similar hardware, etc.")]),e._v(" "),t("p",[e._v("To get into Feeds Management interface go to Settings → Feeds:")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/feed-button_zoom70.png",alt:""}})]),e._v(" "),t("p",[e._v("On this page a user can manage the existing feeds: create, delete, edit.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/feed-menu_zoom70.png",alt:""}})]),e._v(" "),t("p",[e._v("Available options:")]),e._v(" "),t("ul",[t("li",[e._v("Name — a name of a feed.")]),e._v(" "),t("li",[e._v("Auto update — enable and disable automatic downloading of patches to this feed.")]),e._v(" "),t("li",[e._v("Deploy after X hours — a delay in hours between the moment the patchset is\navailable for deployment and the moment it is installed to the feed.")])]),e._v(" "),t("p",[e._v("Every 10 minutes ePortal checks for new patches on the main patch server. If\na new patch is available, it is uploaded to the ePortal server. Note: it is\nuploaded but is not deployed. The patch availability time is considered\nstarting from the moment a new patch appears on the ePortal, and that time is\ntaken into account in "),t("code",[e._v("Deploy after X hours")]),e._v(" option. So, if a user sets "),t("code",[e._v("Deploy after X hours = 10")]),e._v(", the patch will be deployed to the feed 10 hours after it\nhas been downloaded to the ePortal server.")]),e._v(" "),t("p",[e._v("To make the feed auto-update immediately, so new patches are loaded to\nthe feed immediately after they are available on ePortal, set "),t("code",[e._v("Deploy after X hours = 0")]),e._v(".")]),e._v(" "),t("p",[e._v("A special case is a clean installation when ePortal is installed on a new\nserver (there aren't any downloaded archives with patches and feeds with\ndeployed patchsets, including default feed). In this case, if a user\ncreates a new feed and sets Deployed after X hours option right away,\nthen all patches (from the oldest to the latest available) will be\ndeployed to the feed after the specified X hours. This is because the\narchives are downloaded from scratch and will be considered as “just\nappeared on ePortal” — that is, all patches will have the same\nappearance time on ePortal from which the option Deploy after X hours\nwill repel.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/feedmanagement3_zoom70.png",alt:""}})]),e._v(" "),t("p",[e._v("On the main ePortal page, a user can set the corresponding key <> feed pair.\nThis is done in the key creation interface or when editing a key.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/feedmanagement4_zoom70.png",alt:""}})]),e._v(" "),t("p",[e._v("By default, a new key is bound to the default feed, alternatively, a user can\nchoose a desired feed from the drop-down menu.")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/feedmanagement5_01_zoom70.png",alt:""}})]),e._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[e._v("Note")]),t("p",[e._v("When removing a feed all keys attached to this feed will be moved to the\ndefault feed.")])]),t("p",[t("img",{attrs:{src:"/images/feedmanagement6_zoom70.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"cli-to-manage-feeds"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-to-manage-feeds","aria-hidden":"true"}},[e._v("#")]),e._v(" CLI to manage feeds")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("~$ kc.eportal feed --help\nusage: kc.eportal feed [-h] [-a] [-c] [--auto] [--no-auto]\n                       [--deploy-after hours]\n                       [feed]\n\nlist available feeds by default\n\npositional arguments:\n  feed                  feed name\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -a                    action: add new feed\n  -c                    action: change feed\n  --auto                update feed automatically\n  --no-auto             don't update feed automatically\n  --deploy-after hours  deploy after specified hours\n")])])]),t("p",[e._v("List feeds:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal feed\n")])])]),t("p",[e._v("Add auto updated feed:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal feed -a test --auto\n")])])]),t("p",[e._v("Change feed into delayed feed:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal feed -c test --deploy-after 12\n")])])]),t("h2",{attrs:{id:"adding-extra-tag-field"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adding-extra-tag-field","aria-hidden":"true"}},[e._v("#")]),e._v(" Adding extra Tag field")]),e._v(" "),t("p",[e._v("To add an extra Tag field for the server, run:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kcarectl --tag command\n")])])]),t("p",[e._v("where "),t("code",[e._v("command")]),e._v(" is a parameter defined by a user. This parameter will be\ndisplayed in UI for the server. User could add multiple tags for each server.\nEach tag should be separated with "),t("code",[e._v(";")]),e._v(" symbol.")]),e._v(" "),t("p",[e._v("Example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kcarectl --tag "env:prod;ubuntu"\n')])])]),t("p",[e._v("This server has two tags : "),t("code",[e._v("env:prod")]),e._v(" and "),t("code",[e._v("ubuntu")]),e._v(".")]),e._v(" "),t("p",[t("code",[e._v("env:prod")]),e._v(" is a parameter that has tag name "),t("code",[e._v("env")]),e._v(" and the value "),t("code",[e._v("prod")]),e._v(".")]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/addingextratagfield_zoom88.png",alt:""}})]),e._v(" "),t("p",[e._v("To remove all tags from a particular server, run:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kcarectl --tag ""\n')])])]),t("p",[e._v("Where "),t("code",[e._v('""')]),e._v(" is a parameter to delete the previously defined tag.")]),e._v(" "),t("h2",{attrs:{id:"eportal-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportal-api","aria-hidden":"true"}},[e._v("#")]),e._v(" ePortal API")]),e._v(" "),t("p",[e._v("You may need to create a separate ePortal account for API usage with:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal -a api-user -p <password>\n")])])]),t("p",[e._v("It can be useful for SSO/LDAP setups to be able to pass HTTP API credentials via\nbasic auth.")]),e._v(" "),t("h3",{attrs:{id:"get-admin-api-servers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#get-admin-api-servers","aria-hidden":"true"}},[e._v("#")]),e._v(" GET /admin/api/servers")]),e._v(" "),t("p",[e._v("Filters servers on various criteria, iterate through list and get\nserver counts.")]),e._v(" "),t("p",[e._v("Requires basic authorization with read only user permissions.")]),e._v(" "),t("p",[t("strong",[e._v("Query string parameters:")])]),e._v(" "),t("ul",[t("li",[t("code",[e._v("hostname")]),e._v(": String, optional. Return servers with a hostname like value. Value can\ncontain "),t("code",[e._v("%")]),e._v(" placeholder to match any string.")]),e._v(" "),t("li",[t("code",[e._v("ip")]),e._v(": String, optional. Return servers with IP like value. Value can\ncontain "),t("code",[e._v("%")]),e._v(" placeholder to match any string.")]),e._v(" "),t("li",[t("code",[e._v("feed")]),e._v(": String, optional. Return servers attached to feed. Use "),t("code",[e._v("main")]),e._v("\nfor default feed.")]),e._v(" "),t("li",[t("code",[e._v("key")]),e._v(": String, optional. Return servers registered to key.")]),e._v(" "),t("li",[t("code",[e._v("registered_age")]),e._v(": Integer, optional. Return servers registered more than\n"),t("code",[e._v("registered_age")]),e._v(" days ago. If "),t("code",[e._v("registered_age")]),e._v(" is negative then return\nservers registered less or equal -"),t("code",[e._v("registered_age")]),e._v(" days ago. For example:\n"),t("code",[e._v("registered_age=-3")]),e._v(" means to return servers registered 3 or less days ago.\nHours can be specified by adding "),t("code",[e._v("h")]),e._v(" suffix: "),t("code",[e._v("registered_age=4h")]),e._v(" selects\nservers registered more than 4 hours ago.")]),e._v(" "),t("li",[t("code",[e._v("checkin_age")]),e._v(": Integer, optional. Return servers sent check-in more than\n"),t("code",[e._v("checkin_age")]),e._v(" days ago. For negative values see "),t("code",[e._v("registered_age")]),e._v(".")]),e._v(" "),t("li",[t("code",[e._v("updated_age")]),e._v(": Integer, optional. Return servers loaded patches more than\n"),t("code",[e._v("updated_age")]),e._v(" days ago. For negative values see "),t("code",[e._v("registered_age")]),e._v(".")]),e._v(" "),t("li",[t("code",[e._v("is_updated")]),e._v(": Boolean, optional. If "),t("code",[e._v("true")]),e._v(" then return servers updated to latest\navailable patches. If "),t("code",[e._v("false")]),e._v(" return servers without latest patches.")]),e._v(" "),t("li",[t("code",[e._v("limit")]),e._v(": Integer, optional. Limit result to a specified number of entries. By\ndefault "),t("code",[e._v("limit")]),e._v(" is 10.")]),e._v(" "),t("li",[t("code",[e._v("offset")]),e._v(": Integer, optional. Set result to a specified offset. "),t("code",[e._v("limit")]),e._v(" and\n"),t("code",[e._v("offset")]),e._v(" can be used to iterate through result.")]),e._v(" "),t("li",[t("code",[e._v("only_count")]),e._v(": Boolean, optional. Return server count only.")]),e._v(" "),t("li",[t("code",[e._v("tag")]),e._v(": String, optional. Adds filter by server tag. E.g "),t("code",[e._v("tag=env:test")]),e._v(" or "),t("code",[e._v("tag=ubuntu")]),e._v(".")])]),e._v(" "),t("p",[t("strong",[e._v("Response:")])]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"limit"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"offset"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"result"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"99c97tz44uKX13b5"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"ip"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"10.51.16.72"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"hostname"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"localhost.localdomain"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"key"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"some-key"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"feed"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"main"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"registered"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2021-04-08 16:43:23.907671"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"checkin"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2021-07-12 17:35:56.065077"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"updated"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2021-06-01 16:37:03.000000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"euname"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"3.10.0-1160.25.1.el7"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("        // effective kernel version\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"release"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"3.10.0-957.5.1.el7.x86_64"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("  // installed kernel version\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"kernel_id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"9647204d2708cad906a75944ee56ac68fc5b5704"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"patch_level"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("49")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"patch_type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"default"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"tags"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token null"}},[e._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"uptime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("6394092")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"#1 SMP Fri Feb 1 14:54:57 UTC 2019"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"virt"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"kvm"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"kcare_version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2.44-2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"distro"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"CentOS Linux"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"distro_version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"7.6.1810"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"machine"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"x86_64"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"processor"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"x86_64"')]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        ...\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("h3",{attrs:{id:"post-admin-api-delete-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#post-admin-api-delete-server","aria-hidden":"true"}},[e._v("#")]),e._v(" POST /admin/api/delete_server")]),e._v(" "),t("p",[e._v("Removes registered servers by IP or hostname")]),e._v(" "),t("p",[e._v("Requires basic authorization with admin user permissions.")]),e._v(" "),t("p",[t("strong",[e._v("Query string parameters:")])]),e._v(" "),t("ul",[t("li",[t("code",[e._v("hostname")]),e._v(": String, optional. Server's hostname to delete.")]),e._v(" "),t("li",[t("code",[e._v("ip")]),e._v(": String, optional. Server's IP to delete.")])]),e._v(" "),t("p",[e._v("Endpoint requires at least one parameter "),t("code",[e._v("hostname")]),e._v(" or "),t("code",[e._v("ip")]),e._v(".")]),e._v(" "),t("p",[t("strong",[e._v("Response:")])]),e._v(" "),t("p",[e._v("Response contains number of deleted servers.")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"result"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("p",[e._v("For example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("curl --user admin:admin-password -X POST http://your-eportal-domain/admin/api/delete_server?ip=192.168.1.1\n")])])]),t("p",[e._v("Below are examples of using "),t("code",[e._v("/admin/api/delete_server")]),e._v(" endpoint with various\nCM products. Take note, you need a host IP or a hostname to delete it via API.\nIt can be more convenient to use on of:")]),e._v(" "),t("ul",[t("li",[e._v("if you have an access to a host (it is alive) it's a way more simpler to call "),t("code",[e._v("kcarectl --unregister")]),e._v(" to delete the host.")]),e._v(" "),t("li",[e._v("if host is already destroyed you can consider using bulk "),t("a",{attrs:{href:"#clean-inactive-servers"}},[e._v("inactive server cleanup")]),e._v(".")])]),e._v(" "),t("h4",{attrs:{id:"ansible-playbook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ansible-playbook","aria-hidden":"true"}},[e._v("#")]),e._v(" Ansible playbook")]),e._v(" "),t("p",[e._v("Integrating ePortal API access with Ansible is now possible. Rather than calling the kernelcare agent to perform tasks, it is possible to replace it with direct calls to ePortal to achieve the same results.")]),e._v(" "),t("p",[e._v("Unregister KernelCare agent through API playbook:")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[e._v("- hosts"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" kernelcare\n  vars"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n    eportal_srv"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" http"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("//eportal.address.here"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("port if needed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n  tasks"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n    - name"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" unregister kernelcare agent through API\n      uri"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n        url"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{{ eportal_srv }}/admin/api/delete_server?ip={{ ansible_default_ipv4.address|default(ansible_all_ipv4_addresses[0]) }}"')]),e._v("\n        method"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" POST\n        user"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" your-api-user\n        password"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" your-api-user-password\n        force_basic_auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" yes\n")])])]),t("p",[e._v("Example:")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[e._v("- hosts"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" kernelcare\n  vars"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n    eportal_srv"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" http"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("//"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v(".246")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v(".110")]),e._v("\n\n  tasks"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n    - name"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" unregister kernelcare agent through API\n      uri"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n        url"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{{ eportal_srv }}/admin/api/delete_server?ip={{ ansible_default_ipv4.address|default(ansible_all_ipv4_addresses[0]) }}"')]),e._v("\n        method"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" POST\n        user"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" api-user\n        password"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" dummy\n        force_basic_auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" yes\n")])])]),t("p",[e._v("Ad hoc run with:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ansible-playbook -u ansible  ./kernelcare.yml\n")])])]),t("p",[e._v("This can be called during machine tear down to properly remove the server from ePortal.")]),e._v(" "),t("h4",{attrs:{id:"chef-recipe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chef-recipe","aria-hidden":"true"}},[e._v("#")]),e._v(" Chef recipe")]),e._v(" "),t("p",[e._v("Having tighter integration with automation tools like Chef has always been a goal for KernelCare and related tools like ePortal. The following recipe demonstrates how to use the delete_server api to correctly remove a server from ePortal during tear down, and can be integrated with your other recipes to avoid manual operations.")]),e._v(" "),t("p",[e._v("Unregister KernelCare agent through API recipe:")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[e._v("eportal_url = "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"EPORTAL URL"')]),e._v("\neportal_user = "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"EPORTAL API USER NAME"')]),e._v("\neportal_password = "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"EPORTAL API USER PASSWORD"')]),e._v("\n\n# the ip to unregister can be pulled automatically from the system where the recipe is applied"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" or specified manually (by replacing the following line with a simple assignment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nip_to_unregister = "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"#{node['network']['interfaces'][node['network']['default_interface']]['addresses'].select{|k,v| v['family'] == \"")]),e._v("inet"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"}.keys.first}"')]),e._v("\n\n\nhttp_request "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"kernelcare-unregister-api"')]),e._v(" do\n  url "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"#{eportal_url}/admin/api/delete_server?ip=#{ip_to_unregister}"')]),e._v("\n  action "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("post\n  headers("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("'AUTHORIZATION' => \"Basic #"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    Base64.encode64("),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"#{eportal_user}:#{eportal_password}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v('"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nend\n")])])]),t("p",[e._v("Example (kernelcare-unregister-api.rb):")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[e._v("eportal_url = "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"http://192.168.246.110"')]),e._v("\neportal_user = "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"api-user"')]),e._v("\neportal_password = "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"dummy"')]),e._v("\n\nip_to_unregister = "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"#{node['network']['interfaces'][node['network']['default_interface']]['addresses'].select{|k,v| v['family'] == \"")]),e._v("inet"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"}.keys.first}"')]),e._v("\n\nhttp_request "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"kernelcare-unregister-api"')]),e._v(" do\n  url "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"#{eportal_url}/admin/api/delete_server?ip=#{ip_to_unregister}"')]),e._v("\n  action "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("post\n  headers("),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("'AUTHORIZATION' => \"Basic #"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    Base64.encode64("),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"#{eportal_user}:#{eportal_password}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v('"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nend\n")])])]),t("p",[e._v("Ad hoc run with:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("chef-apply kernelcare-unregister-api.rb\n")])])]),t("p",[e._v("Output:")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[e._v("Recipe"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" (chef-apply cookbook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("(chef-apply recipe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  * http_request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("kernelcare-unregister-api"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" action post\n    - http_request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("kernelcare-unregister-api"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" POST to http"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("//"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v(".246")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v(".110")]),e._v("/admin/api/delete_server?ip="),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v(".246")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v(".40")]),e._v("\n")])])]),t("p",[e._v("This can be called during machine tear down to properly remove the server from ePortal.")]),e._v(" "),t("h4",{attrs:{id:"puppet-task"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#puppet-task","aria-hidden":"true"}},[e._v("#")]),e._v(" Puppet task")]),e._v(" "),t("p",[e._v("Puppet provides the framework to run tasks on target systems. The following is a bash script that can run as such a task and demonstrates how to use the delete_server api to correctly remove a server from ePortal during tear down. It can be integrated with your other removal scripts or tasks to avoid manual operations.")]),e._v(" "),t("p",[e._v("Unregister KernelCare agent through API call:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[e._v("#!/bin/bash")]),e._v("\n\nEPORTAL_API_USERNAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("your ePortal api user name"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\nEPORTAL_API_PASSWORD"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("your ePortal api user password"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\nEPORTAL_URL"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'your ePortal URL'")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#this is taken from the primary ip in the system. If awk is available, it is used, but a fallback using other common tools is also provided")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("hash")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("awk")]),e._v(" 2"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/dev/null"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("then")]),e._v("\n        IP_TO_UNREGISTER"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("ip route get 1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("awk")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("NF-2"),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v(";exit}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# using awk")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),e._v("\n        IP_TO_UNREGISTER"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("ip route get 1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cut")]),e._v(" -f 3 -d"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('" "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("head")]),e._v(" -1"),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# simpler alternative for when awk is not available")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("fi")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -kL -u "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${EPORTAL_API_PASSWORD}")]),e._v('"')]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("':'")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${EPORTAL_API_PASSWORD}")]),e._v('"')]),e._v(" -X POST "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${EPORTAL_URL}")]),e._v('"')]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/admin/api/delete_server?ip='")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${IP_TO_UNREGISTER}")]),e._v('"')]),e._v("\n")])])]),t("p",[e._v("Example (unregister_server.sh):")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[e._v("#!/bin/bash")]),e._v("\n\nEPORTAL_API_USERNAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("admin\nEPORTAL_API_PASSWORD"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("admin\nEPORTAL_URL"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'http://192.168.246.110'")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#this is taken from the primary ip in the system. If you want to pick a different one, adjust the next line.")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("hash")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("awk")]),e._v(" 2"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/dev/null"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("then")]),e._v("\n        IP_TO_UNREGISTER"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("ip route get 1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("awk")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("NF-2"),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v(";exit}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# using awk")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),e._v("\n        IP_TO_UNREGISTER"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("ip route get 1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cut")]),e._v(" -f 3 -d"),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('" "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("head")]),e._v(" -1"),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# simpler alternative for when awk is not available")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("fi")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -kL -u "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${EPORTAL_API_PASSWORD}")]),e._v('"')]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("':'")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${EPORTAL_API_PASSWORD}")]),e._v('"')]),e._v(" -X POST "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${EPORTAL_URL}")]),e._v('"')]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/admin/api/delete_server?ip='")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${IP_TO_UNREGISTER}")]),e._v('"')]),e._v("\n")])])]),t("h4",{attrs:{id:"puppet-plan"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#puppet-plan","aria-hidden":"true"}},[e._v("#")]),e._v(" Puppet Plan")]),e._v(" "),t("p",[e._v("If you prefer to have a plan rather than a task, then you can create one from this script with the following steps:")]),e._v(" "),t("ul",[t("li",[e._v("Create a new directory called "),t("code",[e._v("eportal_puppet")])]),e._v(" "),t("li",[e._v("Inside this directory, create a bolt project:"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("bolt project init\n")])])])]),e._v(" "),t("li",[e._v("Create a scripts directory inside it")]),e._v(" "),t("li",[e._v("Place the script above inside of it (call it "),t("code",[e._v("unregister_server.sh")]),e._v(")")]),e._v(" "),t("li",[e._v("Create the bolt plan using:"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("bolt plan new eportal_puppet::unregister_server --script eportal_puppet/scripts/unregister_server.sh\n")])])])]),e._v(" "),t("li",[e._v("Now your plan is ready and can be called directly with:"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("bolt plan run eportal_puppet:unregister_server -t <TARGETS>\n")])])])])]),e._v(" "),t("p",[e._v("Ad hoc run example with:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("bolt plan run eportal_puppet::unregister_server -t 192.168.246.110\n")])])]),t("p",[e._v("This can be called during machine tear down to properly remove the server from ePortal.")]),e._v(" "),t("h2",{attrs:{id:"how-to-setup-eportal-to-use-https"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#how-to-setup-eportal-to-use-https","aria-hidden":"true"}},[e._v("#")]),e._v(" How to setup ePortal to use HTTPS")]),e._v(" "),t("p",[e._v("Some assumptions for a server where e-portal is deployed:")]),e._v(" "),t("h3",{attrs:{id:"terminate-tls-on-eportal-public-nginx-web-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#terminate-tls-on-eportal-public-nginx-web-server","aria-hidden":"true"}},[e._v("#")]),e._v(" Terminate TLS on ePortal public nginx web server")]),e._v(" "),t("ol",[t("li",[e._v("A firewall allows connections to 443 port.")]),e._v(" "),t("li",[e._v("Private and public keys are downloaded on the server.")])]),e._v(" "),t("ul",[t("li",[e._v("Edit SSL configuration template according to your certificates:")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("mv /etc/nginx/eportal.ssl.conf.example /etc/nginx/eportal.ssl.conf\nvi /etc/nginx/eportal.ssl.conf\n")])])]),t("ul",[t("li",[e._v("Include this configuration into the main one:")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sed -e '3iinclude eportal.ssl.conf;' -i /etc/nginx/conf.d/eportal.conf\n")])])]),t("ul",[t("li",[e._v("Restart nginx:")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("service nginx restart\n")])])]),t("h3",{attrs:{id:"terminate-tls-on-external-balancer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#terminate-tls-on-external-balancer","aria-hidden":"true"}},[e._v("#")]),e._v(" Terminate TLS on external balancer")]),e._v(" "),t("p",[e._v("You can use any reverse proxy server of choice to terminate TLS traffic and\nforward requests to ePortal instance. The only requirement is to provide correct\n"),t("code",[e._v("Host")]),e._v(" and "),t("code",[e._v("X-Forwarded-Proto")]),e._v(" headers.")]),e._v(" "),t("p",[e._v("For example balancer nginx config:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("server {\n   listen       443 ssl;\n   server_name  your-eportal-domain;\n\n   # ssl stuff ...\n   # ssl_certificate  ...\n   # ssl_certificate_key ...\n\n   location / {\n      proxy_pass http://eportal-instance-address;\n      proxy_set_header Host $http_host;\n      proxy_set_header X-Forwarded-Proto https;\n   }\n}\n")])])]),t("h3",{attrs:{id:"update-agent-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#update-agent-configuration","aria-hidden":"true"}},[e._v("#")]),e._v(" Update agent configuration")]),e._v(" "),t("p",[e._v("In order to communicate with e-portal, updated to https, you need to modify\nKernelCare configuration file on all the servers if they have IPs hard coded servers\nsettings.")]),e._v(" "),t("p",[e._v("To do that, update "),t("code",[e._v("PATCH_SERVER")]),e._v(" and "),t("code",[e._v("REGISTRATION_URL")]),e._v(" options:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("vi /etc/sysconfig/kcare/kcare.conf\n")])])]),t("p",[e._v("So, after editing your "),t("code",[e._v("/etc/sysconfig/kcare/kcare.conf")]),e._v(" should contain updated\n"),t("code",[e._v("PATCH_SERVER")]),e._v(" and "),t("code",[e._v("REGISTRATION_URL")]),e._v(" environment variables like in the example\nbelow:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("PATCH_SERVER=https://eportal_domain_name/\nREGISTRATION_URL=https://eportal_domain_name/admin/api/kcare\n")])])]),t("p",[e._v("As an alternative you can use ePortal's special endpoint to update patch server address:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("curl -s https://eportal_domain_name/set-patch-server | bash\n")])])]),t("h2",{attrs:{id:"high-availability"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#high-availability","aria-hidden":"true"}},[e._v("#")]),e._v(" High availability")]),e._v(" "),t("p",[e._v("Starting from version 1.28, ePortal supports application level replication. It\nallows to propagate changes in both ways – from a leader to followers and from\nfollowers to the leader.")]),e._v(" "),t("p",[e._v("Configuration settings related to replication and can be changed in "),t("a",{attrs:{href:"#config-files"}},[e._v("ePortal config file")]),e._v(":")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("NODE_URL")]),e._v(": URL to the self instance, needed for auto-discovery purposes")]),e._v(" "),t("li",[t("code",[e._v("LEADER_URL")]),e._v(": URL to the instance from where to fetch changes")]),e._v(" "),t("li",[t("code",[e._v("REPLICATION_SHARED_KEY")]),e._v(": authorization key to access the replication data")]),e._v(" "),t("li",[t("code",[e._v("REPLICATION_CHECK_CERT")]),e._v(": use strict TLS cert check for replication\nrequests. It can be useful to deploy self signed certificates on replicas and\nget encrypted replication traffic without getting proper TLS certificate.")])]),e._v(" "),t("p",[e._v("A leader node discovers followers automatically and after that fetches the changes.")]),e._v(" "),t("p",[e._v("You can use any convenient way to balance agent requests to the ePortal\ncluster. For example, you can add multiple IP addresses to the DNS name or use\nan HTTP balancer.")]),e._v(" "),t("h3",{attrs:{id:"basic-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#basic-setup","aria-hidden":"true"}},[e._v("#")]),e._v(" Basic setup")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Prepare two fresh ePortal instances and assign DNS name to IPs. For example:")]),e._v(" "),t("ul",[t("li",[e._v("eportal1.corp -> 192.168.1.11")]),e._v(" "),t("li",[e._v("eportal2.corp -> 192.168.1.12")]),e._v(" "),t("li",[e._v("eportal.corp -> 192.168.1.11, 192.168.1.12")])])]),e._v(" "),t("li",[t("p",[e._v("Let's choose "),t("code",[e._v("eportal1")]),e._v(" as a leader and "),t("code",[e._v("eportal2")]),e._v(" as a follower.\n"),t("code",[e._v("eportal.corp")]),e._v(" is a cluster hostname to use on servers with KernelCare\nagent.")]),e._v(" "),t("div",{staticClass:"danger custom-block"},[t("p",{staticClass:"custom-block-title"},[e._v("Warning!")]),t("p",[e._v("Please do not use a cluster hostname to perform operations with the ePortal admin UI.")])])]),e._v(" "),t("li",[t("p",[e._v("On the "),t("code",[e._v("eportal1")]),e._v(" define "),t("code",[e._v("NODE_URL")]),e._v(" and "),t("code",[e._v("REPLICATION_SHARED_KEY")]),e._v(" in the\nconfiguration file:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("NODE_URL = 'http://eportal1.corp'\nREPLICATION_SHARED_KEY = 'secret'\n")])])])]),e._v(" "),t("li",[t("p",[e._v("On the "),t("code",[e._v("eportal2")]),e._v(" define "),t("code",[e._v("NODE_URL")]),e._v(", "),t("code",[e._v("LEADER_URL")]),e._v(" and "),t("code",[e._v("REPLICATION_SHARED_KEY")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("NODE_URL = 'http://eportal2.corp'\nLEADER_URL = 'http://eportal1.corp'\nREPLICATION_SHARED_KEY = 'secret'\n")])])])]),e._v(" "),t("li",[t("p",[e._v("That's it. After ePortal restart on both hosts, changes on the "),t("code",[e._v("eportal1")]),e._v("\nwill be replicated to the "),t("code",[e._v("eportal2")]),e._v(" instance and vice versa.")])])]),e._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[e._v("Note")]),t("p",[e._v("You can change the KernelCare agent settings to point to a cluster hostname via:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("curl -s http://eportal.corp/set-patch-server | bash\n")])])])]),t("h3",{attrs:{id:"adding-node-to-an-existing-eportal-instance"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adding-node-to-an-existing-eportal-instance","aria-hidden":"true"}},[e._v("#")]),e._v(" Adding node to an existing ePortal instance")]),e._v(" "),t("p",[e._v("If you already have a working ePortal instance, you can setup a second node,\ndefine "),t("code",[e._v("NODE_URL")]),e._v(" and "),t("code",[e._v("LEADER_URL")]),e._v(" on both instances and trigger full sync on\nthe follower instance:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[root@eportal2.corp]$ kc.eportal replication --full-sync\n")])])]),t("h3",{attrs:{id:"monitoring"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#monitoring","aria-hidden":"true"}},[e._v("#")]),e._v(" Monitoring")]),e._v(" "),t("p",[e._v("You can use "),t("code",[e._v("kc.eportal replication --short-status")]),e._v(" CLI command to check replication\nstatus. It exits with code "),t("code",[e._v("1")]),e._v(" if there are some issues with replication and\noutputs JSON:")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"ok"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("       // overall health status\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"lag"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("         // overall replication lag in seconds\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"last_sync"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("   // overall sync delta in seconds (how many seconds ago was successful communication with an upstream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"upstream"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("     // per upstream metrics\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"node2"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"ok"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"lag"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"last_sync"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"node3"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"ok"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"lag"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"last_sync"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("h3",{attrs:{id:"other-replication-setups"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#other-replication-setups","aria-hidden":"true"}},[e._v("#")]),e._v(" Other replication setups")]),e._v(" "),t("p",[e._v("For one leader and two follower setup:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("     +-> leader <-+\n     |            |\n     |            |\nfollower1       follower2\n")])])]),t("p",[e._v("there is a chance to lose a "),t("code",[e._v("leader")]),e._v(" node and "),t("code",[e._v("follower1")]),e._v("/"),t("code",[e._v("follower2")]),e._v(" will not\ncommunicate with each other. To mitigate this issue, you can deploy a ring\nreplication:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  +-> node1 --+\n  |           |\n  |           v\nnode2 <---- node3\n")])])]),t("p",[e._v("where each instance follows another node.")]),e._v(" "),t("h3",{attrs:{id:"caveats"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#caveats","aria-hidden":"true"}},[e._v("#")]),e._v(" Caveats")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Replication uses HTTP transport. If you deploy ePortal without SSL\ntermination, the replication data will be transferred as-is unencrypted.")])]),e._v(" "),t("li",[t("p",[e._v("For a round-robin balancer setups (DNS or HTTP balancer round-robin)\nKernelCare agent can run onto replication lag in case of sequential\nregistration and following update. You can introduce 10s timeout or repeat\nin your configuration management logic to mitigate the issue.")])]),e._v(" "),t("li",[t("p",[e._v("Replication log is kept for 7 days. If a node loses connectivity for more\nthan 7 days it skips some changes.")])])]),e._v(" "),t("h2",{attrs:{id:"deploying-kernelcare-enterprise"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploying-kernelcare-enterprise","aria-hidden":"true"}},[e._v("#")]),e._v(" Deploying KernelCare Enterprise")]),e._v(" "),t("p",[e._v("You can find instructions to install KernelCare agent on http://your-eportal-domain/admin/docs/.")]),e._v(" "),t("p",[e._v("To install agent through ePortal you can use special endpoint "),t("code",[e._v("http://your-eportal-domain/install-kernelcare")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ export KCARE_MAILTO=admin@mycompany.com\n$ curl -s http://eportal.mycompany.com/install-kernelcare | bash\n$ kcarectl --register my-key\n")])])]),t("p",[e._v("Exporting "),t("code",[e._v("KCARE_MAILTO")]),e._v(" is an optional step, it helps to configure\ncorresponding entry in "),t("code",[e._v("/etc/cron.d/kcare-cron")]),e._v(" to receive all notifications\nrelated to failed KernelCare updates.")]),e._v(" "),t("h3",{attrs:{id:"kernelcare-enterprise-client-config-file"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kernelcare-enterprise-client-config-file","aria-hidden":"true"}},[e._v("#")]),e._v(" KernelCare Enterprise client config file")]),e._v(" "),t("p",[e._v("KernelCare Enterprise client configuration file is located in\n"),t("code",[e._v("/etc/sysconfig/kcare/kcare.conf")])]),e._v(" "),t("p",[e._v("Example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("AUTO_UPDATE=True\nPATCH_SERVER=http://10.1.10.115/\nREGISTRATION_URL=http://10.1.10.115/admin/api/kcare\n")])])]),t("p",[e._v("If "),t("code",[e._v("AUTO_UPDATE")]),e._v(" set to "),t("code",[e._v("True")]),e._v(", KernelCare client will check in every 4 hours,\nand try to download and apply latest patches")]),e._v(" "),t("p",[t("code",[e._v("PATCH_SERVER")]),e._v(" - server from which patches will be downloaded")]),e._v(" "),t("p",[t("code",[e._v("REGISTRATION_URL")]),e._v(" - URL used to register/unregister server")]),e._v(" "),t("h3",{attrs:{id:"deployment-automation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deployment-automation","aria-hidden":"true"}},[e._v("#")]),e._v(" Deployment Automation")]),e._v(" "),t("p",[e._v("It is possible to use automation tools like Ansible/Puppet/Chef/Salt to install\nand operate KernelCare on a big number of systems.")]),e._v(" "),t("p",[e._v("The deployment process includes:")]),e._v(" "),t("ul",[t("li",[e._v("Running "),t("code",[e._v("http://your-eportal-domain/install-kernelcare")]),e._v(" script. You can\npre-download it (verify checksum) or directly execute\n"),t("code",[e._v("curl -s http://your-eportal-domain/install-kernelcare | bash")]),e._v(".")]),e._v(" "),t("li",[e._v("Registering KernelCare agents using an activation key")])]),e._v(" "),t("h4",{attrs:{id:"ansible"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ansible","aria-hidden":"true"}},[e._v("#")]),e._v(" Ansible")]),e._v(" "),t("p",[e._v("To start the automated deployment, you need to specify the following information:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("ePortal server name (or IP) in the "),t("code",[e._v("eportal_srv")]),e._v(" Ansible variable. Other config\nfile options can be found at "),t("RouterLink",{attrs:{to:"/config-options/"}},[e._v("Config Options")]),e._v(" and\n"),t("a",{attrs:{href:"#kernelcare-enterprise-client-config-file"}},[e._v("KernelCare client config file")]),e._v("\n(ePortal).")],1)]),e._v(" "),t("li",[t("p",[e._v("an activation key in the "),t("code",[e._v("activation_key")]),e._v(" Ansible variable. Activation keys can\nbe generated in ePortal as described in\n"),t("a",{attrs:{href:"#managing-keys"}},[e._v("Managing Keys")]),e._v(" (ePortal).")])])]),e._v(" "),t("p",[e._v("Ansible playbook for deployment phase may look like:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("- hosts: kernelcare\n  vars:\n    eportal_srv: http://192.168.250.19\n    activation_key: my-key\n  tasks:\n    - name: Download the installation shell script\n      get_url:\n        url: \"{{ eportal_srv }}/install-kernelcare\"\n        dest: /root/kc-install.sh\n        mode: '0700'\n\n    - name: Run the installation shell script\n      command: /root/kc-install.sh\n\n    - name: register KernelCare agents\n      command: /usr/bin/kcarectl --register {{ activation_key }}\n")])])]),t("p",[e._v("Ansible playbook file example for KernelCare agent removal:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("- hosts: kernelcare\n  tasks:\n    - name: unregister KernelCare agents\n      command: /usr/bin/kcarectl --unregister\n      ignore_errors: yes\n      args:\n        removes: /usr/bin/kcarectl\n\n    - name: remove kernelcare package\n      package:\n        name: kernelcare\n        state: absent\n")])])]),t("h3",{attrs:{id:"changing-eportal-ip-domain"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changing-eportal-ip-domain","aria-hidden":"true"}},[e._v("#")]),e._v(" Changing ePortal IP/domain")]),e._v(" "),t("p",[e._v("You can change ePortal address at any moment by calling two special endpoints on hosts with KernelCare agent:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("curl -s http://your-eportal-domain/set-kernelcare-repo | bash\ncurl -s http://your-eportal-domain/set-patch-server | bash\n")])])]),t("ul",[t("li",[t("code",[e._v("set-kernelcare-repo")]),e._v(" configures new package repo to download agent updates\nthrough ePortal.")]),e._v(" "),t("li",[t("code",[e._v("set-patch-server")]),e._v(" configures new address of patch server.")])]),e._v(" "),t("h2",{attrs:{id:"migrate-eportal"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#migrate-eportal","aria-hidden":"true"}},[e._v("#")]),e._v(" Migrate ePortal")]),e._v(" "),t("p",[e._v("Here is a procedure to migrate feed/server/key configuration and patches data from one ePortal\nto another. ePortal version on a new host should be >=1.18 and equal or greater\nthan on an old host.")]),e._v(" "),t("p",[e._v("If you migrate from Debian-based to Debian-based system you can simply:")]),e._v(" "),t("ul",[t("li",[e._v("Stop ePortal on both hosts.")]),e._v(" "),t("li",[e._v("Copy "),t("code",[e._v("/var/lib/eportal")]),e._v(" to a new host. Note: directory owner must stay as "),t("code",[e._v("eportal:eportal")]),e._v(".")]),e._v(" "),t("li",[e._v("Copy config "),t("code",[e._v("/etc/eportal/config")]),e._v(" if it exists.")]),e._v(" "),t("li",[e._v("Run migration "),t("code",[e._v("/usr/share/kcare-eportal/migratedb.py --upgrade")]),e._v(" on a new host.")]),e._v(" "),t("li",[e._v("Start ePortal on a new host.")])]),e._v(" "),t("p",[e._v("Migration from RHEL-based distro is more elaborate. Later we refer to a "),t("code",[e._v("$BASE_DIR")]),e._v(" variable in scripts.\nYou can export it for RHEL-based distros:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("export BASE_DIR=/usr/share/kcare-eportal\n")])])]),t("p",[e._v("or for Debian-based distros:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("export BASE_DIR=/var/lib/eportal\n")])])]),t("p",[e._v("or for docker-based installation use corresponding data directory. For example if you\nrun container as "),t("code",[e._v("docker run -v /var/lib/eportal/data:/var/lib/eportal/data kernelcare/eportal")]),e._v("\nuse /var/lib/eportal/data as "),t("code",[e._v("$BASE_DIR")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("export BASE_DIR=/var/lib/eportal/data\n")])])]),t("ul",[t("li",[t("p",[e._v("Stop ePortal on both hosts:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[old-host ~]# systemctl stop eportal\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[new-host ~]# systemctl stop eportal\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Remove db files on a new host:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[new-host ~]# rm $BASE_DIR/*.sqlite*\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Copy database files "),t("code",[e._v("$BASE_DIR/*.sqlite*")]),e._v(" from an old host to a new host.")])]),e._v(" "),t("li",[t("p",[e._v("(Optional) copy runtime LDAP and Feed Source settings "),t("code",[e._v("$BASE_DIR/config/config.json")]),e._v(".")])]),e._v(" "),t("li",[t("p",[e._v("(Optional) copy ePortal web app settings "),t("code",[e._v("/usr/share/kcare-eportal/config/local.py")]),e._v("\nor for new ePortal "),t("code",[e._v("/etc/eportal/config")]),e._v(" to "),t("code",[e._v("/etc/eportal/config")]),e._v(" on a new\nhost if it exists.")])]),e._v(" "),t("li",[t("p",[e._v("Copy "),t("code",[e._v("$BASE_DIR/instance-id")]),e._v(" so our billing can know that the new ePortal was\nmigrated and to avoid double billing.")])]),e._v(" "),t("li",[t("p",[e._v("Copy patch data "),t("code",[e._v("$BASE_DIR/{arch,resources,user-resources}")]),e._v(" to a new host.")])]),e._v(" "),t("li",[t("p",[e._v("Set file owner. For RHEL-based distros:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[new-host ~]# chown -R nginx:nginx $BASE_DIR\n")])])]),t("p",[e._v("For Debian-based distros:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[new-host ~]# chown -R eportal:eportal $BASE_DIR\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Run migration "),t("code",[e._v("/usr/share/kcare-eportal/migratedb.py --upgrade")]),e._v(" on a new host.")])]),e._v(" "),t("li",[t("p",[e._v("Start ePortal on the new host:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[new-host ~]# systemctl start eportal\n")])])])])]),e._v(" "),t("h2",{attrs:{id:"database-backup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#database-backup","aria-hidden":"true"}},[e._v("#")]),e._v(" Database backup")]),e._v(" "),t("h3",{attrs:{id:"create-backup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-backup","aria-hidden":"true"}},[e._v("#")]),e._v(" Create backup")]),e._v(" "),t("p",[e._v("kc.eportal utility have an option to create database backup")]),e._v(" "),t("p",[t("code",[e._v("kc.eportal backup-db <path_to_directory>")]),e._v(" - creates backup in provided directory. If directory is not exists it will be created.")]),e._v(" "),t("p",[e._v("For example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal backup-db /usr/share/kcare-eportal/db-backup_$(date '+%Y-%m-%d')\n")])])]),t("h3",{attrs:{id:"recover-from-backup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#recover-from-backup","aria-hidden":"true"}},[e._v("#")]),e._v(" Recover from backup")]),e._v(" "),t("p",[e._v("You can replace existing databases (by default, in eportal home directory) with the backup files.")]),e._v(" "),t("p",[e._v("IMPORTANT: ePortal should be stopped before replacing database files. Backup files should have owner and group "),t("code",[e._v("nginx:nginx")]),e._v(".")]),e._v(" "),t("p",[e._v("For example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl stop eportal\ncp -f /path/to/backup_dir/* /usr/share/kcare-eportal/\nchown nginx:nginx /usr/share/kcare-eportal/*.sqlite*\nsystemctl start eportal\n")])])]),t("p",[e._v("Also, you need to check remote patchsource settings (Login, Password, Download URL in eportal UI), and after it download patches")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal kcare download-missing\nkc.eportal libcare download-missing\nkc.eportal qemu download-missing\nkc.eportal db download-missing\n")])])]),t("h2",{attrs:{id:"config-files"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#config-files","aria-hidden":"true"}},[e._v("#")]),e._v(" Config files")]),e._v(" "),t("ul",[t("li",[e._v("ePortal config: "),t("code",[e._v("/etc/eportal/config")]),e._v(". Config for old versions (<1.35): "),t("code",[e._v("/usr/share/kcare-eportal/local.py")]),e._v(".")]),e._v(" "),t("li",[e._v("Web Server (nginx) config: "),t("code",[e._v("/etc/nginx/conf.d/eportal.conf")]),e._v(".")]),e._v(" "),t("li",[e._v("Data directory (RHEL based distros): "),t("code",[e._v("/usr/share/kcare-eportal")]),e._v(".")]),e._v(" "),t("li",[e._v("Data directory (Debian based distros): "),t("code",[e._v("/var/lib/eportal")]),e._v(".")])]),e._v(" "),t("h2",{attrs:{id:"stopping-starting"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#stopping-starting","aria-hidden":"true"}},[e._v("#")]),e._v(" Stopping & starting")]),e._v(" "),t("p",[e._v("To stop/start/reload/restart configuration of nginx server:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ systemctl stop|start|reload|restart nginx\n")])])]),t("p",[e._v("To stop/start/restart ePortal (Python):")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ systemctl stop|start|restart eportal\n")])])]),t("h2",{attrs:{id:"log-files"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-files","aria-hidden":"true"}},[e._v("#")]),e._v(" Log files")]),e._v(" "),t("p",[e._v("ePortal log: "),t("code",[e._v("journalctl -u eportal")])]),e._v(" "),t("p",[e._v("Nginx ePortal access log: "),t("code",[e._v("/var/log/nginx/access.log")])]),e._v(" "),t("p",[e._v("Nginx error log: "),t("code",[e._v("/var/log/nginx/error.log")])]),e._v(" "),t("h3",{attrs:{id:"log-rotation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-rotation","aria-hidden":"true"}},[e._v("#")]),e._v(" Log rotation")]),e._v(" "),t("p",[e._v("By default there is no predefined parameters for ePortal's logs rotation. If you\nwant to enable it for the files listed above:")]),e._v(" "),t("ul",[t("li",[e._v("Install "),t("code",[e._v("logrotate")]),e._v(" package")]),e._v(" "),t("li",[e._v("Create/edit "),t("code",[e._v("/etc/logrotate.d/eportal")]),e._v(" configuration file")])]),e._v(" "),t("p",[e._v("Example logrotate config:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("/var/log/nginx/kcare-eportal.log {\n    daily\n    rotate 5 # keep 5 last archives\n    missingok # it's ok if there is no such file\n    notifempty # do nothing if file is empty\n    compress\n}\n")])])]),t("h2",{attrs:{id:"nagios-zabbix-support"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nagios-zabbix-support","aria-hidden":"true"}},[e._v("#")]),e._v(" Nagios & Zabbix support")]),e._v(" "),t("p",[e._v("KernelCare.ePortal since version 1.2 supports server monitoring similar to\n"),t("RouterLink",{attrs:{to:"/kc-agent-monitoring/#nagios-plugin"}},[e._v("Nagios")]),e._v("\n& "),t("RouterLink",{attrs:{to:"/kc-agent-monitoring/#zabbix-template"}},[e._v("Zabbix")]),e._v(" monitoring.")],1),e._v(" "),t("p",[e._v("You can curl the API directly to receive the information:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("https://yourserver/admin/api/kcare/nagios/KCAREKEY\n")])])]),t("p",[e._v("or you can use "),t("a",{attrs:{href:"https://patches.kernelcare.com/downloads/nagios/check_kcare",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://patches.kernelcare.com/downloads/nagios/check_kcare"),t("OutboundLink")],1),e._v(" script by modifying KEY_KCARE_NAGIOS_ENDPOINT in it to point to your server (change "),t("a",{attrs:{href:"https://cln.cloudlinux.com/clweb",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cln.cloudlinux.com/clweb"),t("OutboundLink")],1),e._v(" (link to old UI) or "),t("a",{attrs:{href:"https://cln.cloudlinux.com/console/auth/login",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cln.cloudlinux.com/console/auth/login"),t("OutboundLink")],1),e._v(" (link to new UI) with "),t("a",{attrs:{href:"https://yourserver/admin",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://yourserver/admin"),t("OutboundLink")],1),e._v(" ).")]),e._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[e._v("Note")]),t("p",[e._v("Access using "),t("code",[e._v("PARTNER_LOGIN/TOKEN")]),e._v(" is not supported by KernelCare.ePortal.")])]),t("h2",{attrs:{id:"usage-reports"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#usage-reports","aria-hidden":"true"}},[e._v("#")]),e._v(" Usage reports")]),e._v(" "),t("p",[e._v("In common case, usage reports are sending automatically but when it's not\npossible, ePortal will try to send report as an email. That requires configured\nSendmail (SSMTP) on the host. You can find a short instruction below.")]),e._v(" "),t("p",[e._v("If mail sending attempt fails, ePortal will save the reports in\n"),t("code",[e._v("/usr/share/kcare-eportal/reports")]),e._v(" which should be sent manually.")]),e._v(" "),t("h3",{attrs:{id:"how-to-configure-sendmail-ssmtp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#how-to-configure-sendmail-ssmtp","aria-hidden":"true"}},[e._v("#")]),e._v(" How to configure Sendmail (SSMTP)")]),e._v(" "),t("p",[e._v("First of all you need to install "),t("code",[e._v("ssmtp")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("yum install -y ssmtp\n")])])]),t("p",[e._v("Edit "),t("code",[e._v("/etc/ssmtp/ssmtp.conf")]),e._v(" file in accordance with your SMTP server\nconfiguration. Here is a simple config file describing a common way to connect\nto Gmail accounts:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("root=username@gmail.com\nmailhub=smtp.gmail.com:587\nhostname=localhost\nUseSTARTTLS=YES\nAuthUser=username@gmail.com\nAuthPass=xxxxxxxxxxxxxxxxxxx\nFromLineOverride=YES\nTLS_CA_File=/etc/ssl/certs/ca-certificates.crt\n")])])]),t("p",[e._v("Actual location of a TLS_CA_Files depends on Linux distribution:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('"/etc/ssl/certs/ca-certificates.crt",                // Debian/Ubuntu/Gentoo etc.\n"/etc/pki/tls/certs/ca-bundle.crt",                  // Fedora/RHEL 6\n"/etc/ssl/ca-bundle.pem",                            // OpenSUSE\n"/etc/pki/tls/cacert.pem",                           // OpenELEC\n"/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem", // CentOS/RHEL 7\n')])])]),t("p",[e._v("Also you could get if from:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("curl-config --ca\n")])])]),t("p",[e._v("Now you can test a connection:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("echo -n 'Subject: test\\n\\nTesting ssmtp' | sendmail -v some-recipient@gmail.com\n")])])]),t("h2",{attrs:{id:"custom-environment-variables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#custom-environment-variables","aria-hidden":"true"}},[e._v("#")]),e._v(" Custom environment variables")]),e._v(" "),t("p",[e._v("You can define your own environment variables for ePortal process.")]),e._v(" "),t("p",[e._v("There is the "),t("code",[e._v("/usr/share/kcare-eportal/environment")]),e._v(" folder, which is basically\ndaemon tools compatible envdir.")]),e._v(" "),t("p",[e._v("For example, to disable the default https verification you can set the\n"),t("code",[e._v("PYTHONHTTPSVERIFY")]),e._v(" environment variable to "),t("code",[e._v("0")]),e._v(" as follows:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("echo 0 > /usr/share/kcare-eportal/environment/PYTHONHTTPSVERIFY`\n")])])]),t("h2",{attrs:{id:"authentication-using-single-sign-on"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#authentication-using-single-sign-on","aria-hidden":"true"}},[e._v("#")]),e._v(" Authentication using Single Sign On")]),e._v(" "),t("p",[e._v('ePortal supports Single Sign On authentication by "OAuth 2.0" standard, "Authorization Code" flow.')]),e._v(" "),t("h3",{attrs:{id:"configuration-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuration-2","aria-hidden":"true"}},[e._v("#")]),e._v(" Configuration")]),e._v(" "),t("p",[e._v("To enable SSO you need to configure OAuth2 authentication service provider and ePortal.")]),e._v(" "),t("h4",{attrs:{id:"okta-application-setup-example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#okta-application-setup-example","aria-hidden":"true"}},[e._v("#")]),e._v(" Okta Application setup example")]),e._v(" "),t("p",[e._v("You set up your OpenID Connect application inside the Okta Admin Console:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("In the Admin Console, go to "),t("strong",[e._v("Applications")]),e._v(" > "),t("strong",[e._v("Applications")]),e._v(".")])]),e._v(" "),t("li",[t("p",[e._v("Click "),t("strong",[e._v("Create App Integration")]),e._v(".")])]),e._v(" "),t("li",[t("p",[e._v("On the Create a new app integration page, select "),t("strong",[e._v("OIDC - OpenID Connect")]),e._v("\nfor the "),t("strong",[e._v("Sign-in method")]),e._v(" and then select "),t("strong",[e._v("Web Application")]),e._v(" as the\n"),t("strong",[e._v("Application type")]),e._v(".")])]),e._v(" "),t("li",[t("p",[e._v("Fill in the "),t("strong",[e._v("Application Settings")]),e._v(".")])])]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[e._v("Setting")])]),e._v(" "),t("th",[t("strong",[e._v("Value")])])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("Sign-in redirect URI")]),e._v(" "),t("td",[e._v("http://eportal_ip/admin/sso/login/callback")])]),e._v(" "),t("tr",[t("td",[e._v("Sign-out redirect URI")]),e._v(" "),t("td",[e._v("http://eportal_ip/admin")])])])]),e._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[e._v("Obtain "),t("em",[e._v("Client ID")]),e._v(", "),t("em",[e._v("Client secret")]),e._v(", the full URL to the "),t("code",[e._v("/authorize")]),e._v(", "),t("code",[e._v("/token")]),e._v(", "),t("code",[e._v("/userinfo")]),e._v(" endpoints.")])]),e._v(" "),t("h4",{attrs:{id:"eportal-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportal-setup","aria-hidden":"true"}},[e._v("#")]),e._v(" ePortal setup")]),e._v(" "),t("p",[e._v("On the ePortal machine, configure SSO settings.")]),e._v(" "),t("p",[e._v("Edit "),t("a",{attrs:{href:"#config-files"}},[e._v("ePortal config file")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('OIDC_AUTH_URL="https://dev-61441893.okta.com/oauth2/v1/authorize"\nOIDC_TOKEN_URL="https://dev-61441893.okta.com/oauth2/v1/token"\nOIDC_USERINFO_URL="https://dev-61441893.okta.com/oauth2/v1/userinfo"\n\nOIDC_CLIENT_ID="0Aa134lzhUKj8jDMo5d7"\nOIDC_CLIENT_SECRET="AoBNuWRLRu2dxIR3Q0btO53N1entmGxBjQqwmjVL"\n')])])]),t("p",[e._v("Restart ePortal (see "),t("a",{attrs:{href:"#stopping-starting"}},[e._v("Stopping & Starting")]),e._v("\nsection, choose a corresponding OS).")]),e._v(" "),t("p",[e._v("If all settings configured correctly the new "),t("strong",[e._v("Sign In with SSO")]),e._v(" button has to appear on login page "),t("code",[e._v("http://eportal_ip/admin/login")])]),e._v(" "),t("p",[t("img",{attrs:{src:"/images/sso_eportal.png",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"custom-patches-storage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#custom-patches-storage","aria-hidden":"true"}},[e._v("#")]),e._v(" Custom patches storage")]),e._v(" "),t("p",[e._v("By default patches with databases are stored in "),t("code",[e._v("/usr/share/kcare-eportal")]),e._v(" for RHEL-based\nsystems and "),t("code",[e._v("/var/lib/eportal")]),e._v(" for deb-based systems. You can configure it to\nuse split storage, for example to keep patches on external block device.")]),e._v(" "),t("p",[e._v("Edit "),t("a",{attrs:{href:"#config-files"}},[e._v("ePortal config file")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("PATCHES_DIR = '/path/to/patches/storage'\n")])])]),t("p",[e._v("Run:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kc.eportal sync-nginx-conf\n")])])]),t("p",[e._v("It initializes storage and makes corresponding modifications to nginx config to\nserve patches from a new place.")]),e._v(" "),t("p",[e._v("And restart "),t("code",[e._v("nginx")]),e._v(" and "),t("code",[e._v("eportal")]),e._v(" services to apply changes:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl restart eportal nginx\n")])])])])},[],!1,null,null,null);a.default=r.exports}}]);